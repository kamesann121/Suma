<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>あ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* 左側のボタンリスト */
        #debug-panel {
            position: fixed; left: 0; top: 0; bottom: 0; width: 280px;
            background: rgba(0, 0, 0, 0.9); color: white; overflow-y: auto;
            padding: 15px; z-index: 1000; border-right: 2px solid #ffaa00;
        }
        
        h3 { font-size: 14px; color: #ffaa00; border-bottom: 1px solid #444; padding-bottom: 10px; }
        
        .file-section { margin-bottom: 20px; }
        .file-name { font-size: 12px; background: #333; padding: 5px; margin-bottom: 5px; display: block; }
        
        .anim-button {
            display: block; width: 100%; padding: 10px; margin-bottom: 4px;
            background: #444; color: #fff; border: none; text-align: left;
            font-size: 11px; cursor: pointer; border-radius: 4px;
            transition: background 0.2s;
        }
        
        .anim-button:hover { background: #666; }
        .anim-button.active { background: #ffaa00; color: #000; font-weight: bold; }

        /* 現在の情報の表示 */
        #status-display {
            position: fixed; top: 20px; right: 20px; 
            background: rgba(0,0,0,0.7); color: #00ff00; padding: 15px;
            border-radius: 8px; font-family: monospace; font-size: 16px;
            pointer-events: none; border: 1px solid #00ff00;
        }
    </style>
</head>
<body>

    <div id="debug-panel">
        <h3>Animation Inspector</h3>
        <div id="controls-container">
            </div>
    </div>

    <div id="status-display">
        Waiting for selection...
    </div>

    <script>
        let scene, camera, renderer, clock, mixer, model;
        let actions = {};
        let currentAction;

        window.onload = function() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x333333);
            
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.2, 3); // キャラクターが見えやすい位置

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // 明るくする
            scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 2.0));
            scene.add(new THREE.GridHelper(10, 10, 0x555555, 0x333333));

            const loader = new THREE.GLTFLoader();

            // キャラクター本体をロード
            loader.load('./m.glb', (gltf) => {
                model = gltf.scene;
                scene.add(model);
                mixer = new THREE.AnimationMixer(model);

                // 各ファイルを読み込んで、入っているアニメーションをボタン化する
                const files = [
                    { name: 'm.glb', url: './m.glb' },
                    { name: 'a.glb', url: './a.glb' },
                    { name: 'b.glb', url: './b.glb' }
                ];

                files.forEach(file => {
                    const section = document.createElement('div');
                    section.className = 'file-section';
                    section.innerHTML = `<span class="file-name">File: ${file.name}</span>`;
                    document.getElementById('controls-container').appendChild(section);

                    loader.load(file.url, (animGltf) => {
                        animGltf.animations.forEach((clip, index) => {
                            // 識別用のユニークな名前を作成
                            const uniqueID = `${file.name}_${index}`;
                            actions[uniqueID] = mixer.clipAction(clip);

                            // ボタン作成
                            const btn = document.createElement('button');
                            btn.className = 'anim-button';
                            btn.innerText = `[${index}] ${clip.name}`;
                            btn.onclick = () => {
                                // 全ボタンの active クラスを外す
                                document.querySelectorAll('.anim-button').forEach(b => b.classList.remove('active'));
                                btn.classList.add('active');
                                
                                playSelected(uniqueID, index, clip.name, file.name);
                            };
                            section.appendChild(btn);
                        });
                    });
                });
            });

            function playSelected(id, index, name, fileName) {
                // 前のアニメーションを消す
                if (currentAction) currentAction.fadeOut(0.2);
                
                const next = actions[id];
                next.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(0.2).play();
                currentAction = next;

                // 画面右上に情報を出す
                document.getElementById('status-display').innerHTML = 
                    `FILE: ${fileName}<br>INDEX: ${index}<br>NAME: ${name}`;
                
                console.log(`Playing: File=${fileName}, Index=${index}, Name=${name}`);
            }

            clock = new THREE.Clock();
            function animate() {
                requestAnimationFrame(animate);
                const delta = clock.getDelta();
                if (mixer) mixer.update(delta);
                renderer.render(scene, camera);
            }
            animate();
        };

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
